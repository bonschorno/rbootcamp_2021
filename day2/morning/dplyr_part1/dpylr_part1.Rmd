---
title: "Dplyr - Part I"
author: 
  - "Colin Walder"
date: "15.09.2021"
output:
  xaringan::moon_reader:
    css: xaringan-themer.css
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
---

```{r setup, include=FALSE}
options(htmltools.dir.version = FALSE)
knitr::opts_chunk$set(fig.retina = 3, message = FALSE) #rendering sharp plots / not showing messages
```

```{r xaringan-themer, include=FALSE, warning=FALSE}
library(xaringanthemer)
style_mono_light(base_color = "#081c15")
library(tidyverse)
library(palmerpenguins)
data(package = "palmerpenguins")
library(knitr)
library(kableExtra)
```

## Outline

???

- Learn how to work with the package dplyr and its most important functions, also called verbs
- We're going to do this in 2 parts to ease the learning process
- We'll be looking at fours functions, which are fairly self-explanatory
- Present functions
- As before, we start with the theoretical input and finish with some exercises
- Questions?

--

- Introducing `dplyr` and its verbs

--

- `select()`: picks variables based on their names

--

- `mutate()`: adds new variables that are functions of existing variables

--

- `rename()` & `relocate()`

--

- Exercises

---

## Dplyr - A Grammar of Data Manipulation

???

- Layering has very much to do with the pipe. "And then" approach to data wrangling.
- Btw: I don't properly cite the references but there's always an underlying hyperlink. So, you can just click on the word.
- The following five functions are the most important ones
- Again, we're looking at the first two in the first part and I will present "filter" and "summarise" in the second part. "Arrange" won't be part of the presentation as checking the help file is enough to understand how the function works.
- Let's start with "select" then.

--

- Grammar in this context means a framework which follows a (layered) approach to manipulate and transform your data in a structured manner (adapted from [this post](https://towardsdatascience.com/a-comprehensive-guide-to-the-grammar-of-graphics-for-effective-visualization-of-multi-dimensional-1f92b4ed4149))

--

-	In the words of the authors: "Set of verbs that help you solve the most common data manipulation challenges."

--

- `select()`: picks variables based on their names.

--

- `mutate()`: adds new variables that are functions of existing variables

--

- `filter()`: picks cases based on their values.

--

- ...

---

## Select(): Subsetting columns

???

- Explain what the function does: Subsetting columns
- This is the simplest form.

--

```{r}
penguins %>% 
  head(n = 3) %>% 
  kable() %>% kable_styling(font_size = 14)
```

--

```{r}
penguins %>% 
  select(species, island, bill_length_mm) %>% #<<
  head(n = 3) %>% 
  kable() %>% kable_styling(font_size = 14)
```

---

???

- To make it less laborious we can also work with the colon to subset columns
- Or, when we have columns with very long names for instance, we can also combine the colon and column positions to subset variables

#### Subsetting by column names with `:` 

```{r}
penguins %>% 
  select(species:bill_length_mm) %>% #<<
  head(n = 3) %>% 
  kable() %>% kable_styling(font_size = 10)
```

--

#### Subsetting by column positions

```{r}
penguins %>% 
  select(1:3) %>% #<<
  head(n = 3) %>% 
  kable() %>% kable_styling(font_size = 10)
```

---

???

- If we don't want columns, there are two ways to do this:
- We work with the exclamation mark
- Or we work with the minus sign

--

#### Subsetting by column positions with `!`

```{r}
penguins %>% 
  select(!1:3) %>% #<<
  head(n = 3) %>% 
  kable()
```

---

#### Dropping variables

```{r}
penguins %>% 
  select(-body_mass_g) %>% #<<
  head(n = 1) %>% 
  kable() %>% kable_styling(font_size = 10)
```

--

```{r}
penguins %>% 
select(-c(year, sex, species)) %>% #<<
  head(n = 1) %>% 
  kable() %>% kable_styling(font_size = 10)
```

--

### Questions?

---

???

- In the next few slides, we're going to look at so-called helper functions
- Facilitate subsetting columns considerably, especially in larger dataset

--

## Useful helper functions

--

- `starts_with()`

```{r}
penguins %>% 
  select(starts_with("bill")) %>% #<<
  head(n = 2) %>% 
  kable()
```

---

- `ends_with()`

```{r}
penguins %>% 
  select(ends_with("mm")) %>% #<<
  head(n = 2) %>% 
  kable() %>% kable_styling(font_size = 12)
```

--

- `contains()`

```{r}
penguins %>% 
  select(contains("length")) %>% #<<
  head(n = 2) %>% 
  kable() %>% kable_styling(font_size = 12)
```

---

- `where()`: Selects the variables for which a function returns `TRUE.`

```{r}
penguins %>% 
  select(where(is.factor)) %>% #<<
  head(n = 2) %>% 
  kable() %>% kable_styling(font_size = 12)
```

--

```{r}
penguins %>% 
  select(where(is.numeric)) %>% #<<
  head(n = 2) %>% 
  kable() %>% kable_styling(font_size = 12)
```

---

???

Conveniently, combinations of helper functions are possible 

--

## Combinations are possible

```{r}
penguins %>% 
  select(year,
         contains("length"),
         island) %>% 
  head(n = 2) %>% 
  kable()
```

---

## Mutate(): Create and modify columns

--

```{r}
penguins %>% 
  mutate(body_mass_kg = body_mass_g/1000, .keep = "used") %>%  #<<
  head(n = 3) %>% 
  kable() %>% kable_styling(font_size = 12)
```

--

```{r}
penguins %>% 
  mutate(bill_ratio = bill_length_mm/bill_depth_mm, .keep = "used") %>%   #<<
  head(n = 1) %>% 
  kable() %>% kable_styling(font_size = 12)
```

---

```{r}
penguins %>% 
  mutate(body_mass_kg = body_mass_g/1000, #<<
         bill_square = bill_length_mm*bill_length_mm, .keep = "used") %>%   #<<
  head(n = 3) %>% 
  kable()
```

---

## `Rename()`: Change variable names 

--

```{r}
penguins %>% 
  rename(weight = body_mass_g, #<<
         island_name = island) %>%  #<<
  head(n = 3) %>% 
  kable() %>% kable_styling(font_size = 12)
```

---

### Pro tip:

```{r}
penguins %>% 
  select(island,
         weight = body_mass_g) %>% #<<
  head(n = 3) %>% 
  kable()
```

---

## Relocate(): Change column order

- `year` as first column

```{r}
penguins %>% 
  relocate(year) %>% #<<
  head(n = 1) %>% 
  kable() %>% kable_styling(font_size = 12)
```

---

- `sex` after `species`

```{r}
penguins %>% 
  relocate(sex, .after = species) %>% #<<
  head(n = 1) %>% 
  kable() %>% kable_styling(font_size = 12)
```

- `island` before `species`

```{r}
penguins %>% 
  relocate(island, .before = species) %>% #<<
  head(n = 1) %>% 
  kable() %>% kable_styling(font_size = 12)
```

---

class: center, middle

<h3>
Questions?
</h3>

---

## Recap & outlook

--

- Introduced to `dpylr`

--

- `select()`: picks variables based on their names.

--

- `mutate()`: adds new variables that are functions of existing variables

--

- `rename()` & `relocate()`

--

- Next up: `group_by()` and `summarise()`

---

class: center, middle

<h3>
Time to exercise!
</h3>
